!function(a,b){a.module("app",["ng-socket.io","ngResource","ngMessages","ui.bootstrap"])}(window.angular,window._),function(a){a.module("app").constant("REST_API_ROUTE","/api/").constant("TOKEN_STORAGE","__token__").constant("AUTH_SCHEMA","Bearer")}(window.angular),function(a,b){a.module("app").factory("_",[function(){return b}])}(window.angular,window._),function(a){a.module("app").factory("Auth",["REST_API_ROUTE","$q","$http",function(a,b,c){return function(){var d=this;d.signIn=function(d,e,f,g){return b(function(b,h){c.post(a+"auth/signin",{login:d,password:e}).success(function(a){"function"==typeof f&&f(a),b(a)}).error(function(a){h(a),"function"==typeof g&&g(a)})})},d.signUp=function(d,e,f){return b(function(b,g){c.post(a+"auth/signup",{user:d}).success(function(a){"function"==typeof e&&e(a),b(a)}).error(function(a){"function"==typeof f&&f(a),g(a)})})}}}])}(window.angular),function(a){a.module("app").service("UsersSvc",["REST_API_ROUTE","$http","$resource","$q",function(a,b,c,d){var e,f={},g=this;g.getUser=function(b,e,g){return d(function(d,h){if(b in f)d(f[b]);else{var i=c(a+"users/:id");i.get({id:b}).$promise.then(function(a){f[b]=a,"function"==typeof e&&e(a),d(a)},function(a){"function"==typeof g&&g(a),h(a)})}})},g.user=function(a){return"undefined"==typeof a?f[e]:(e=a._id,void(f[e]=a))}}])}(window.angular),function(a){a.module("app").service("AuthSvc",["REST_API_ROUTE","TOKEN_STORAGE","AUTH_SCHEMA","Auth","UsersSvc","$q","$window","$http",function(a,b,c,d,e,f,g,h){var i=new d,j=null,k=this;try{j=JSON.parse(g.localStorage)[b]}catch(l){}k.refreshToken=function(){return f(function(b,c){h.post(a+"auth/refresh",{},{headers:{Authorization:k.token()}}).success(function(a){j=g.localStorage=a.token,b(!0)}).error(function(a){k.signOut(),c(a)})})},k.signIn=function(a,b,c,d){return f(function(e,f){i.signIn(a,b).then(function(a){j=a.token,"function"==typeof c&&c(a),e(a)},function(a){"function"==typeof d&&d(a),f(a)})})},k.signUp=function(a,b,c){return f(function(d,e){i.signUp(a).then(function(a){j=a.token,"function"==typeof b&&b(a),d(a)},function(a){"function"==typeof c&&c(a),e(a)})})},k.signOut=function(){j=null;try{var a=JSON.parse(g.localStorage);delete a[b],g.localStorage=JSON.stringify(a)}catch(c){}},k.isAuthenticated=function(){return null!=j},k.token=function(a){if("undefined"!=typeof a){j=a;try{var c=JSON.parse(g.localStorage);c[b]=a,g.localStorage=JSON.stringify(c)}catch(d){c={},c[b]=a,g.localStorage=JSON.stringify(c)}}return j},k.header=function(){return c+" "+j}}])}(window.angular),function(a){a.module("app").controller("AuthCtrl",["$scope","$rootScope","AuthSvc","$modal",function(a,b,c,d){var e=this;a.pending=!1,a.isAuthenticated=c.isAuthenticated(),b.$on("authenticated",function(){e.modal&&c.isAuthenticated()&&e.modal.dismiss(),a.isAuthenticated=c.isAuthenticated()}),a.showModal=function(){e.modal=d.open({templateUrl:"templates/auth-modal.html",size:"sm"})},a.signOut=function(){c.signOut(),a.isAuthenticated=c.isAuthenticated()}}]).controller("SignInCtrl",["$scope","$rootScope","AuthSvc","IoSvc",function(a,b,c,d){a.loginErr=!1,a.pending=!1,a.signIn=function(){a.pending=!0,c.signIn(a.login,a.password).then(function(){a.pending=!1,b.$emit("authenticated")},function(){a.pending=!1,a.loginErr=!0})}}]).controller("SignUpCtrl",["$scope","$rootScope","AuthSvc",function(a,b,c){a.loginErr=!1,a.pending=!1,a.user={username:"",email:"",password:""},a.signUp=function(){a.pending=!0,c.signUp(a.user).then(function(){a.user={username:"",email:"",password:""},a.pending=!1,b.$emit("authenticated"),a.signup.$setPristine()},function(){a.pending=!1,a.loginErr=!0})}}])}(window.angular);